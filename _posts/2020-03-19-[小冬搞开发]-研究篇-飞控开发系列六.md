---
layout: post
title: "[小冬搞开发]-研究篇-飞控开发系列(六)"
subtitle: '小冬搞机之强化与迁移学习'
author: "Lordon"
header-img: img/jassica/jessica-jung.jpg
catalog: true
tags:
  - Quadcopter
  - [小冬搞开发]
  - RL
---

> 大江东去浪淘尽千古风流人物,要数风流人物还看今朝啊~

# 关于本文
跟老板交流所记录内容:<br>
用基于神经网络的策略控制器取代传统的基于模型的运动规划和跟踪控制器。此策略网络将映射结果作为输入，并直接计算控制操作。<br>
实验结果表明这种基于神经网络的控制策略确实能够达到与传统的运动规划器和跟踪控制器相当的精度和稳定性。此外，通过强化学习对网络进行微调，在某些性能上优于传统的基于模型的方法，说明我们的模拟强化框架比基于模型的方法具有更高的性能。

## 用网络来拟合飞控
> 虽然港科大去年已经有人在做了...紧随其后研究下<br>

当前进展:<br>

- 在wim使用tensorflow搭建了五个全连接层的神经网络,`输入`为position_error(3×1),velocity_error(3×1)以及euler_error(3×1),`输出`为四电机angle_velocity(4×1).数据通过控制之前在gazebo中仿真的四旋翼随机飞行采集所得.通过对近万个数据进行反复训练后loss下降比较可观,当然炼金调参对现阶段还不适合,进而采取下一步动作.

- ROS与tensorflow的结合使用在古月的机器人制作一书中已经有所介绍,大部分都是使用摄像头调用opencv识别物体,网友们也都是基于此开源项目展开研究的.此类项目与我们所研究的重合点在于编写python脚本读取无人机的odom话题message通过我们第一步训练过的网络计算出四个电机角速度,这一向量返回发布到speed_control话题上.
<!-- TODO ros读取tensorflow数据进展-->
###### 3.21
- 这两天因为没在ubuntu写的程序bug挺多，根据思路复现的代码确实不可信，调崩了gazebo之后换新代码立马见效。
Rotors代码结构写的特别棒值得深入研究，上午使用python脚本读取ros运行时话题数据，在消息类型上吃了大亏，反复topic info测试了好几遍才读取成功，接下来 就是数据转存与处理.

> 上午/script/test.py 读取msgs数据成功

- 读取完ros结点的数据接下来就是跑模型预测控制量，通过初始化自定义rosnode：rostensorflow发布motor_vel话题，自定义float64类型msgs，rosrun脚本之后rostopic list确实生成了话题，rostopic echo moter_vel显示接口设置成功。

> 下午rostopic echo moter_vel成功

- 晚上因为白天修改了代码调用tensorflow模型总是出错，重新复现逐句调试后才成功跑通，至此ros与tensorflow脚本调用部分顺利接通，能够实现`根据采集到的仿真环境中传感器采集数值调用tensorflow预训练模型得到四个电机转速控制量`，接下来便是roscpp部分读取motors_vel话题上的电机转速控制量来控制电机转动。

> 晚上 调用模型预测电机控制量成功

###### 3.22
- 在roscpp部分发布电机转速控制后gazebo中飞机并不运动，gazebo与command有话题数据均显示正常，飞机乱飞..到此均已完成,下午整理文档后面再进行优化.


----


### 罕见的吐槽
我的渣渣笔记本当初虽然已经尽可能预留了空间,但是如今ubuntu剩余空间已不足20G,加上显卡又渣,屏幕又小拿着还沉...疯狂暗示:P,所以我现在对这个(搞深度学习)也不是那么感冒.<br>
老王今天(3.19)说开学可能要5月初了,实验室的服务器他会想办法分配一下,后面几天用起来会方便一点,近期就不是很想做这方面的工作,不过师兄对这个很感兴趣一直在调试,等有进展再继续完善.

###### 4.3 最新进展
三月份训练的方式确实欠妥，使用了9个变量作为输入参数，四个电机控制量作为输出，在仿真环境中只起到了证明训练出来的网络能应用到ROS中的作用。为此老王特地开会讨论了这个问题，老王提出了他的state transform
想法💡.


这一次我们使用前一时刻的状态作为输入，这次我们使用了21个量，输出为下一时刻的状态量，使用RNN却得了很好的效果。
<!--TODO这里缺loss训练图-->


### 网络首先由m100数据训练,利用仿真环境获取m100模型的传感器数据,训练控制策略;
这一部分参考:数据采集以及处理参考[开发系列四](https://tcloser.github.io/2020/03/08/%E5%B0%8F%E5%86%AC%E6%90%9E%E5%BC%80%E5%8F%91-%E5%9F%BA%E7%A1%80%E7%AF%87-%E9%A3%9E%E6%8E%A7%E5%BC%80%E5%8F%91%E7%B3%BB%E5%88%97%E5%9B%9B/).


### 这部分都弄完之后尝试一下小样本迁移学习

<!-- 
## 写在前面:

**笔者个人电脑配置:**

github所给模型/meshes多为`.dae`、`.obj`+`.mtl`或者`.stl`文件<br>

<center> 「SDF和URDF的区别」</center>

1-[solidwork2017链接教程](https://mp.weixin.qq.com/s/iHwBFrFamsjsMIuoYZffnA)，感谢佳林的baiduyun会员

<img src="/img/200223image/ship.jpg"> 
-->



<!-- 导航一般指的是融合各传感器的数据，包括陀螺仪、加速度计、磁力计、气压计、GPS、激光测距仪、视觉摄像头等，最后得到飞行器的飞行状态，包括姿态、速度、位置等信息。这个是整个系统的基础，你没有无人机的飞行状态就没法做反馈控制，所以是最底层，最基础的。这方面的研究目前可以集中在视觉图像方面，对于传统的惯性导航+GPS也没有太多的研究空间。
第二、关于控制呢，目标就是实现你所需的飞行任务，根据期望计算出相应的执行机构行程。最简单的比如姿态控制，遥控器上的遥杆对应的无人机的姿态期望，复杂的就是路径跟踪、轨迹跟踪，根据地面站规划好的航线进行自动飞行。这其实对于目前的无人机都已经是非常成熟的内容了，控制算法那更是五花八门，除了最常用的PID之外，H无穷，自抗扰、自适应、模型预测、反步法等等，做过的研究无数，早已经不是当下研究的热点。
第三、制导，也就是你说的plan。制导（Guidance）要完成的内容差异性会比较大。这个要根据具体的目标进行分析。比如，你要在航线上进行实时避障，那就是研究避障的算法；你要在航线上对某个地面目标进行跟踪，那就属于目标跟踪的内容；你要想在某个区域进行最小时间搜索，那就属于路径规划的内容。这方面的研究到目前为止还是属于比较热门的内容，也是无人机走向智能时代的必然要求，建议你在这方面多开展你的研究。 -->
