---
layout: post
title: "[小冬搞开发]-基础篇-飞控开发系列(四)"
subtitle: '小冬搞机之数据处理部分'
author: "Lordon"
header-img: img/jassica/jessica-jung.jpg
catalog: true
tags:
  - Quadcopter
  - [小冬搞开发]
---
# 关于本文
上一篇中使用blender对m100结构等进行了精确设计,各个零件的导出文件以及[设计工程已经放在了Github](https://github.com/Tcloser/NEU_M100_description),算是整合了好几个工程中有用的部分,后面会跟同伴创建Organizations将工程一起放进去[Github](https://github.com/NEU-ROS-packages-for-DJI-M100-drone?type=source).

## 需要处理的数据
odom:<br>
1 position(x,y,z)<br>
2 pose(x,y,z,w)<br>
3 drone body(线速度+角速度)(x,y,z)<br>

trajectony:<br>
destination (x,y,z)<br>

----
<center>总结一下流程</center>
odom+trajectony->lee_position_control->mottor_speed(angle)(vx,vy,vz)

## 保存ros话题数据

1 - /src同目录下创建/bagfile,并cd进入<br>
2 - 启动launch文件同时保存所有话题数据<br>

```
$ rosbag record -a  + $ roslaunch rotors_gazebo neu_m100_start.launch
	或者只保存部分
$ rosbag record /NEU_m100/imu /NEU_m100/gps /NEU_m100/motor_speed
```

3 - 查看数据包属性<br>
```
$ rosbag info 2020-03-07-09-16-24.bag

dynamic_reconfigure/Config              [958f16a05573709014982821e6822580]
dynamic_reconfigure/ConfigDescription   [757ce9d44ba8ddd801bb30bc456f946f]
gazebo_msgs/LinkStates                  [48c080191eb15c41858319b4d8a609c2]
gazebo_msgs/ModelStates                 [48c080191eb15c41858319b4d8a609c2]
geometry_msgs/PointStamped              [c63aecb41bfdfd6b7e1fac37c7cbe7bf]
geometry_msgs/Pose                      [e45d45a5a1ce597b249e23fb30fc871f]
geometry_msgs/PoseWithCovarianceStamped [953b798c0f514ff060a53a3498ce6246]
geometry_msgs/TransformStamped          [b5764a33bfeb3588febc2682852579b0]
geometry_msgs/TwistStamped              [98d34b0043a2093cf9d9345ab6eef12e]
```

4 - 转换成txt保存(you may only specify one input topic)[这里使用脚本solve_data.sh]<br>
```
$ rostopic echo -b 2020-03-07-09-16-24.bag -p geometry_msgs/Pose > m100_data.txt
```

## shell脚本处理

1 - 目录下创建sove_data.sh,使用vscode编写<br>
```
touch sove_data.sh
```
2 - ctrl+shift+c调出命令行窗口运行之前要改权限<br>
```
$ chmod +x sove_data.sh
```
3 - 运行<br>
```
$ ./sove_data.sh
```

-----------------

CODE solve_data.sh:
```
#! /bin/bash
ls -a
echo -e "Pls input the name of bag : \c "
read filename
echo output /NEU_m100/gps
rostopic echo -b $filename -p /NEU_m100/gps > $PWD/data/gps.txt
echo output /NEU_m100/imu
rostopic echo -b $filename -p /NEU_m100/imu > $PWD/data/imu.txt
......

```






## 地理参数

```
https://www.ngdc.noaa.gov/geomag/calculators/magcalc.shtml#igrfwmm
东北大学
gps_update_freq="5.0"
lat:41° 45' 57"  lon:123° 25' 30" 
latitude=41.765833 
longitude=73.984000 
alt=50
reference_magnetic_field_north="0.26764"
reference_magnetic_field_east="-0.04413"
reference_magnetic_field_down="0.47029"
```
